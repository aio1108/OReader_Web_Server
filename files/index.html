<!DOCTYPE html>
<!-- saved from url=(0050)http://getbootstrap.com/examples/starter-template/ -->
<html lang="en">
<head>
	<!-- meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <title>O-Reader</title>

    <!-- Bootstrap core CSS -->
    <link href="css/bootstrap.css" rel="stylesheet">
    <!-- Custom styles for this template -->
    <link href="css/starter-template.css" rel="stylesheet">
 	<link rel="icon" href="favicon.ico" type="image/x-icon" />
	<link rel="shortcut icon" href="http://getbootstrap.com/assets/ico/favicon.ico">
	<link rel="stylesheet" type="text/css" href="css/style.css" />
	<link rel="stylesheet" type="text/css" href="css/pinterest-style.css" />
	<link href="css/jquery.dataTables.css" rel="stylesheet">
	<!-- Oreder客製化的CSS -->
	<link href="css/Oreader_style.css" rel="stylesheet">
	
	    <!-- Bootstrap core JavaScript=========================== -->
    <!-- Placed at the end of the document so the pages load faster -->
		<!--[if lt IE 9]><script src="../../assets/js/ie8-responsive-file-warning.js"></script><![endif]-->

		<!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
		<!--[if lt IE 9]>
		  <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
		  <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
		<![endif]-->
	
	<script type="text/javascript" src="js/jquery.min.js"></script>
	<script>window["_GOOG_TRANS_EXT_VER"] = "1";</script>
	<script type="text/javascript" src="js/freewall.js"></script>
	<script src="js/bootbox.js"></script>
	<script type="text/javascript" src="js/jquery.dataTables.js"></script>
	<script type="text/javascript" src="js/highcharts.js"></script>
	<script src="http://code.highcharts.com/maps/modules/map.js"></script>
    <script src="http://code.highcharts.com/maps/modules/exporting.js"></script>
    <script src="http://code.highcharts.com/mapdata/countries/tw/tw-all.js"></script>
    <script type="text/javascript"src="http://maps.google.com/maps/api/js?sensor=false" ></script>
	<script type="text/javascript" src="js/useful/extractJSONData.js"></script>

		<style type="text/css">
			.loading {
                margin-top: 10em;
                text-align: center;
                color: gray;
            }
		</style>
  	<script type="text/javascript">
  	var serverURL="http://127.0.0.1:8081/hyAPPServer/";
  	
  	
  	$(document).ready(function() {
		if (navigator.userAgent.match(/IEMobile\/10\.0/)) {
			  var msViewportStyle = document.createElement('style')
			  msViewportStyle.appendChild(
				document.createTextNode(
				  '@-ms-viewport{width:auto!important}'
				)
			  )
			  document.querySelector('head').appendChild(msViewportStyle)
		}
		
		
 		
 		$.getJSON(serverURL+"categoryDS", function(data){
 			$('#category').append("<option value='-1'>請選擇</option>");
 		    $.each(data, function (index, value) {
 		    	var option_html="<option value="+value._id+">"+value.name+"</option>";
 		    	$('#category').append(option_html);
 		    });
 		});
 		$(document).on("click", "a[data-toggle=modal]", function(e) {
 			e.preventDefault();
 			 var triggerA=$(this);
 			 var appendTarget=$(triggerA).attr('data-target');
 			 var defaultViewType = $(triggerA).find('#infoStorage').attr('attr2');
 			 if($.trim($(appendTarget).find('.modal-body').html())=="")
 			 {
				extractDispatch(triggerA);
				//parsing_agricultural_trade(triggerA,"agricultural_trade.xml")
				//parsing_stock_publish(triggerA,"stock_publish.xml");
				//parsing_air_pollution(triggerA,"air_pollution.xml");
 			 }
 			 else
 			 {

 			 }
 			
 		});
 		//登入
 		
 		
 		//取得收藏
 		/*
 		var mail_id="weichen@hyweb.com.tw";
 		mail_id="opendatanews1@gmail.com";
 		//mail_id="sunnywu@hyweb.com.tw";
 		//TCA@test.com.tw
 		var favoriteURL=serverURL+"userDS?id="+mail_id;//pretend 登入成功 預先取得 收藏內容呈現再freeWall
 		
 		$.getJSON(favoriteURL, function(data){

			if(data.subscribes!=null)
			{
			
				$.each(data.subscribes, function (index2, value2) {

	 		    	$("#freewall").empty();
	 		    	var preferViewTypeId=value2.preferViewType._id;
	 		    	var preferViewTypeName=value2.preferViewType.name;
	 	 		    
	 		    	$.each(value2, function (attr, value) {
	 		    	
	 		    		//參數
	 		    		if(attr=="metaData")
	 		    		{
		 			    	fillWall(attr,value)
	 		    		}
	 	 		    });
	 		    });	
			}


 		});
 		*/
 		
 		//搜尋
		$(document).on("click", "#btnSearch", function() {
			
			//loading gif
			$("#freewall").empty()
			$("#freewall").prepend("<div id='searchAjaxLoad' align='middle'><img src='../img/loading.gif' style='margin-top:150px ;width:64px; height:64px;' alt=''></div>");
			
			var searchURL=serverURL+"metaDS?";
			var searchParam="";
			if($("#data_description").val()!="")
			{
				searchParam=searchParam+"&key="+encodeURI($("#data_description").val());
			}
			if($("#category").val()!="-1"&&$("#category").val()!=null)
			{
				searchParam=searchParam+"&category="+$("#category").val();
			}
			searchURL=searchURL+searchParam;
			$.getJSON(searchURL, function(data){
	 		    $.each(data, function (index, value) {
	 		    	fillWall(index,value);
	 		    });
	 		   setTimeout("$(window).resize();", 500);
	 		   
	 		});
			
			$("#searchBlock").attr("class","collapse");//關閉
			
	    });
 		
 		//預先搜尋
 		//$('#btnSearch').click();

		var nua = navigator.userAgent
		var isAndroid = (nua.indexOf('Mozilla/5.0') > -1 && nua.indexOf('Android ') > -1 && nua.indexOf('AppleWebKit') > -1 && nua.indexOf('Chrome') === -1)
		if (isAndroid) {
		  $('select.form-control').removeClass('form-control').css('width', '100%')
		}

		$(document).on( "click", "a[name=mapChange]", function() {
			if(!$(this).hasClass("noViewSepia"))
			{
				var parentModal=$(this).parents('.modal-body:first');
				$(parentModal).find('div[id*=ViewContainer]').hide();
				$(parentModal).find('#mapViewContainer').show('slow');
			}
		});
		$(document).on( "click", "a[name=tableChange]", function() {
			if(!$(this).hasClass("noViewSepia"))
			{
				var parentModal=$(this).parents('.modal-body:first');
				$(parentModal).find('div[id*=ViewContainer]').hide();
				$(parentModal).find('#tableViewContainer').show('slow');
			}
		});
		$(document).on( "click", "a[name=chartChange]", function() {
			if(!$(this).hasClass("noViewSepia"))
			{
				var parentModal=$(this).parents('.modal-body:first');
				$(parentModal).find('div[id*=ViewContainer]').hide();
				$(parentModal).find('#chartViewContainer').show('slow');	
			}
		});
	
		
		
		
		
		
		
		//old
		
		$('#example').dataTable();
		
		 //$('#chartViewContainer').resize();
		 $(window).resize(function() {
			 	//alert("22");
			    //height = chart.height;
			    //width = $("#chartViewContainer").width();
			    //chart.setSize(width, height, doAnimation = true);
		});
		 
		 
		 
  	});
 	function fillWall(index,value)
 	{
 			//參數
	    	var _id=value._id;
	    	var name=value.name;
	    	var frequency=value.frequency;
	    	var department=value.department;
	    	var wallImg="";
	    	var action=value.action;//ex: business_indicator.xml
	    	var getDataURL=serverURL+"hyAppDS?_action="+action;
	    	
	    	//準備freewall內容
	    	$('body').append("<div class='modal fade' id='"+_id+"' tabindex='0' role='dialog' aria-labelledby='loginBlockLabel' aria-hidden='true'><div class='modal-dialog'><div class='modal-content'><div class='modal-header'><button type='button' class='close' data-dismiss='modal' aria-hidden='true'>&times;</button><h4 class='modal-title' id='myModalLabel'>"+name+"</h4></div><div class='modal-body'></div></div></div></div>")

	    	
	    	//準備freewall
	    	if(value.defaultViewType._id=="chart")
	    	{
	    		wallImg="img/view/chart.png";
	    	}
	    	else if(value.defaultViewType._id=="bar_chart")
	    	{
	    		wallImg="img/view/bar_chart.png";
	    	}
	    	else if(value.defaultViewType._id=="map")
	    	{
	    		wallImg="img/view/map.png";
	    	}
	    	else if(value.defaultViewType._id=="table")
	    	{
	    		wallImg="img/view/table.png";
	    	}
	    	
	    	var viewTypesStr="";
	    	$.each(value.viewTypes, function (index_vt, value_vt) {
	    		viewTypesStr+=value_vt._id+",";
	    		//alert(value_vt.name);
	    	});
	    	viewTypesStr=viewTypesStr.substring(0, viewTypesStr.length-1);
	    	
	    	//thName
	    	var tableTHName="";
	    	$.each(value.fields, function (index_f, value_f) {
	    		//alert(value_dvt._id);
	    		tableTHName+=value_f.name+",";
	    	});
	    	tableTHName=tableTHName.substring(0, tableTHName.length-1);
	    	//var wall_html="<div class='brick'><a href='"+getDataURL+"' data-toggle='modal' data-target='#"+_id+"'><img src='"+wallImg+"' width='100%'><div class='info'>";
	    	var wall_html="<div class='brick'><a href='#' data-toggle='modal' data-target='#"+_id+"'><img src='"+wallImg+"' width='100%'><div class='info'>";
	    	wall_html=wall_html+"<h3>"+name+"</h3>";
	    	wall_html=wall_html+"<h5>更新頻率："+frequency+"/次</h5><br/>提供機關："+department+"</h5>";
	    	wall_html=wall_html+"<br/><br/><div id='infoStorage' attr1='"+action+"' attr2='"+value.defaultViewType._id+"' attr3='"+viewTypesStr+"' attrTableTHName='"+ tableTHName +"' ></div><div class='read-more'>觀看詳細資料...</div></div></a></div>";
	    	
	    	
	    	$("#freewall").append(wall_html);
	    
	    	$.each(value.defaultViewType, function (index_dvt, value_dvt) {
	    		//alert(value_dvt._id);
	    		//alert(value_dvt.name);
	    	});
	    	$('#searchAjaxLoad').remove();
 	}
	</script>
	
	
</head>

  <body>
	<div class="navbar navbar-inverse navbar-fixed-top" role="navigation" id="header-block">
      <div class="container">
		<a class="navbar-brand" href="#"><img src="img/OReader_logo.png" width="150px" height="40px"></a>
		<a href="#" data-toggle="modal" data-target="#loginBlock" alt="使用者" id="userLogInButtom"></a>
		<a href="#" data-toggle="collapse" data-target="#searchBlock" alt="搜尋" id="searchButton"></a>
      </div>
    </div>
	<!--搜尋彈出區塊-->
	<div id="searchBlock" class="collapse">
		<div class="container">				
			<form class="form-horizontal">
				<fieldset> 

					<!-- Form Name -->
					<legend></legend>


					<div class="control-group">
					  <label class="control-label" for="category">分類</label>
					  <div class="controls">
						<select id="category" name="category" class="">
						</select>
					  </div>
					</div>

					<!-- Text input-->
					<div class="control-group">
					  <label class="control-label" for="data_description">主要欄位說明</label>
					  <div class="controls">
						<input id="data_description" name="data_description" type="text" placeholder="" class="">
					  </div>
					</div>
					<input type="button" value="搜尋" id="btnSearch" class="btn btn-primary">
				</fieldset>
			</form>	
		</div>
	</div>
	
	
	<!--主畫面開始-->
    <div class="container">
    	
		<!--FREEWALL 呈現區塊-->
		<div id="freewall" class="free-wall">
		
		</div>
    </div>
	
		<!-- 彈出的登入視窗-->
		<div class="modal fade" id="loginBlock" tabindex="-2" role="dialog" aria-labelledby="loginBlockLabel" aria-hidden="true">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
						<h4 class="modal-title" id="myModalLabel">使用者</h4>
					</div>
					<div class="modal-body">
						<form role="form">
						  <div class="form-group">
						    <label for="userid">帳號</label>
						    <input type="email" class="form-control" id="userid" placeholder="輸入帳號...">
						  </div>
						  <div class="form-group">
						    <label for="userpwd">密碼</label>
						    <input type="password" class="form-control" id="userpwd" placeholder="輸入密碼...">
						  </div>
						  <button type="submit" class="btn btn-primary">登入</button>
						</form>
					</div>
					<!-- <div class="modal-body">
						Facebook | Google
					</div> -->
				  <!--
				  <div class="modal-footer">
					<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
					<button type="button" class="btn btn-primary">Save changes</button>
				  </div>
				  -->
				</div>
			</div>
		</div>

		</div>
	<!-- /.container -->	
    <!-- footer
    ================================================== -->	
    <div id="footer">
		<div>Copyright © 2014 Userful Peoples</div>

    </div>
    	<script type="text/javascript">
			
			var wall = new freewall("#freewall");
			wall.reset({
				selector: '.brick',
				animate: true,
				cellW: 200,
				cellH: 'auto',
				onResize: function() {
					wall.fitWidth();
				}
			});
			
			var images = wall.container.find('.brick');
			var length = images.length;
			images.css({visibility: 'hidden'});
			images.find('img').load(function() {
				-- length;
				if (!length) {
					setTimeout(function() {
						images.css({visibility: 'visible'});
						wall.fitWidth();
					}, 505);
				}
			});

		</script>		
		<script src="js/bootstrap.min.js"></script>
</body>
</html>